{
  "name": "cmd_start",
  "nodes": [
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 1;",
        "options": {}
      },
      "id": "dedc1124-7bb6-48a9-b590-8ba8ad91076a",
      "name": "Insert User (no ref)",
      "type": "n8n-nodes-base.mySql",
      "position": [
        2260,
        760
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 1;",
        "options": {}
      },
      "id": "8dc2e785-32de-4dfd-afba-18ae30eaa07a",
      "name": "Update Referrer Balance",
      "type": "n8n-nodes-base.mySql",
      "position": [
        2020,
        500
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 1;",
        "options": {}
      },
      "id": "c1be1dbd-db6a-416f-b66b-1555a2ef7d6f",
      "name": "Log Referral (referrer)",
      "type": "n8n-nodes-base.mySql",
      "position": [
        2040,
        720
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 1;",
        "options": {}
      },
      "id": "62de23fa-f8f4-4e7c-9fe4-10cdacde9619",
      "name": "Log Referral (new user)",
      "type": "n8n-nodes-base.mySql",
      "position": [
        2320,
        600
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 1;",
        "options": {}
      },
      "id": "e6dd43fa-0f39-41e9-81be-121f606cb4ef",
      "name": "Get User Data",
      "type": "n8n-nodes-base.mySql",
      "position": [
        2140,
        -60
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 1;",
        "options": {}
      },
      "id": "197b1711-1a42-400c-bb21-0b31c2a962e2",
      "name": "Count Devices",
      "type": "n8n-nodes-base.mySql",
      "position": [
        2140,
        200
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{$json[\"message\"][\"chat\"][\"id\"]}}",
        "text": "üéâ –í–∞—à –¥—Ä—É–≥ –ø—Ä–∏–Ω—è–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, –≤–∞–º –¥–æ–±–∞–≤–ª–µ–Ω–æ *50‚ÇΩ* –Ω–∞ –±–∞–ª–∞–Ω—Å!",
        "additionalFields": {}
      },
      "id": "4dc88edf-34eb-42ec-8c41-efd65d02a6e6",
      "name": "Send Friend Notification",
      "type": "n8n-nodes-base.telegram",
      "position": [
        2140,
        -240
      ],
      "typeVersion": 1.2,
      "webhookId": "6e946434-be3a-4505-8523-1876c298dc58",
      "credentials": {
        "telegramApi": {
          "id": "9hfs9gxsjeru7ML3",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3dfc07b6-7d1f-4c30-857c-741439a5bf9b",
                    "leftValue": "={{$json.telegram.callback_query.data }}",
                    "rightValue": "start_activate",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "start_activate"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.telegram.message.text}}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "/start"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d67b6285-4a47-40b1-8134-e4f77d104111",
                    "leftValue": "={{$json.telegram.callback_query.data }}",
                    "rightValue": "start",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "start"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1120,
        140
      ],
      "id": "7faa4dd8-3eec-43f4-986d-7f9214d1e76e",
      "name": "Switch"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1400,
        140
      ],
      "id": "db4fbcb3-7bb6-4982-98d2-9307ab0f991a",
      "name": "Start"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE users SET\n  balance=$2,\n  tarif=$3,\n  activated=TRUE,\n  activated_at=NOW()\nWHERE id=$1 AND activated=FALSE;\n\n  \nSELECT * FROM users WHERE id=$1 LIMIT 1;\n\nSELECT $1;",
        "options": {
          "queryReplacement": "={{ $json.telegram.user_id }},\n{{ $json.config.tarif.balance_have_referer }},\n{{ $json.config.tarif.pay_month }}"
        }
      },
      "id": "9028652e-4ed5-466a-bf91-bfc20a00cd35",
      "name": "UserActivate",
      "type": "n8n-nodes-base.mySql",
      "position": [
        -40,
        -40
      ],
      "typeVersion": 2.4,
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.telegram.chat_id }}",
        "text": "={{$json.telegram.send_text}}",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "d761e31b-0c72-4417-b80d-78007bfd103e",
      "name": "Send Activated",
      "type": "n8n-nodes-base.telegram",
      "position": [
        360,
        -40
      ],
      "typeVersion": 1.2,
      "webhookId": "6e946434-be3a-4505-8523-1876c298dc58",
      "credentials": {
        "telegramApi": {
          "id": "9hfs9gxsjeru7ML3",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": "dinTFsFtKgJKMNH9",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [
        1180,
        80
      ],
      "id": "2bfdf21e-6e32-492d-ad64-ffaf92d0dbf5",
      "name": "Execute cmd_devices.json",
      "notes": "Execute cmd_devices.json"
    },
    {
      "parameters": {
        "jsCode": "const text = `**–í–Ω–∏–º–∞–Ω–∏–µ, –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω**\n–ù–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ`;\n\nconst json=$json;\n// const json=$node[\"Start\"].json;\njson.telegram.send_text=text;\n\nreturn [{\n  json\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -40,
        -700
      ],
      "id": "bf288d3e-3481-4a5a-b785-30fb8ee6e49c",
      "name": "AlreadyActivated"
    },
    {
      "parameters": {
        "chatId": "={{$json.telegram.chat_id }}",
        "text": "={{$json.telegram.send_text}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "start"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "de422a06-1a4b-4b8f-90d5-8503a85bbfa0",
      "name": "Send AlreadyActivated",
      "type": "n8n-nodes-base.telegram",
      "position": [
        160,
        -700
      ],
      "typeVersion": 1.2,
      "webhookId": "0e719cb2-eaff-4358-9785-33cb4ba9be68",
      "credentials": {
        "telegramApi": {
          "id": "9hfs9gxsjeru7ML3",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3dfc07b6-7d1f-4c30-857c-741439a5bf9b",
                    "leftValue": "={{$json.user.activated}}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Activated"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.referrer.id}}",
                    "rightValue": 10000,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    },
                    "id": "6ac5ac7c-91e6-4fcd-864e-cf58a336ea74"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "HaveRef"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d67b6285-4a47-40b1-8134-e4f77d104111",
                    "leftValue": 0,
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "NoRef"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -500,
        560
      ],
      "id": "acf41b47-8351-40a6-996d-388ee1f11b2f",
      "name": "Switch1"
    },
    {
      "parameters": {
        "chatId": "={{$json.telegram.chat_id }}",
        "text": "={{$json.telegram.send_text}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å VPN üöÄ",
                    "additionalFields": {
                      "callback_data": "start_activate"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "06f4e8c2-d632-4158-8fcc-f1fa7fdebd3b",
      "name": "Send Activate",
      "type": "n8n-nodes-base.telegram",
      "position": [
        200,
        720
      ],
      "typeVersion": 1.2,
      "webhookId": "6e946434-be3a-4505-8523-1876c298dc58",
      "credentials": {
        "telegramApi": {
          "id": "9hfs9gxsjeru7ML3",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const firstName = $json.telegram.message.from.first_name || '';\nconst lastName = $json.telegram.message.from.last_name || '';\n\nconst fullName = `${firstName} ${lastName}`.trim();\n\nconst referrerFirstName = $json.referrer.first_name || '';\nconst referrerLastName = $json.referrer.last_name || '';\n\nconst referrerFullName = `${referrerFirstName} ${referrerLastName}`.trim();\n\n\n\n\nconst text = `–ü—Ä–∏–≤–µ—Ç, ${fullName}!\n\n–í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª —Å—é–¥–∞ ${referrerFullName}, –ø–æ—ç—Ç–æ–º—É –≤—ã –º–æ–∂–µ—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å VPN –∏ –ø–æ–ª—É—á–∏—Ç—å 100‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!\n\nüí∞ —Å–∞–º–∞—è –Ω–∏–∑–∫–∞—è —Ü–µ–Ω–∞ –Ω–∞ —Ä—ã–Ω–∫–µ!\nüöÄ –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å\nüíÉüèø –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Å–∞–π—Ç–∞–º\nüí≥ –æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∞–º–∏ –†–§ üá∑üá∫ –∏ –°–ë–ü\n\n–°—Ç–æ–∏–º–æ—Å—Ç—å 100‚ÇΩ/–º–µ—Å –∑–∞ 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –¥–æ 5 —É—Å—Ç—Ä–æ–π—Å—Ç–≤.\n\nüë´ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –≤ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ 50‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞. –í–∞—à–∏ –¥—Ä—É–∑—å—è –ø–æ–ª—É—á–∞—Ç 100‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å!\n\n‚¨áÔ∏è ‚¨áÔ∏è  –ñ–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É!  ‚¨áÔ∏è ‚¨áÔ∏è`;\n\n\nconst json=$json;\n// const json=$node[\"Start\"].json;\njson.telegram.send_text=text;\n\nreturn [{\n  json\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -20,
        620
      ],
      "id": "cbf7203b-322f-4c30-8d41-adb274024b4e",
      "name": "ActivateHaveRef"
    },
    {
      "parameters": {
        "jsCode": "const firstName = $json.telegram.from.first_name || '';\nconst lastName = $json.telegram.from.last_name || '';\nconst fullName = `${firstName} ${lastName}`.trim();\n\n\nconst balance_no_referer=$json.config.tarif.balance_no_referer;\nconst balance_have_referer=$json.config.tarif.balance_have_referer;\nconst balance_to_referer=$json.config.tarif.balance_to_referer;\nconst pay_month=$json.config.tarif.pay_month;\n\n\nconst text = `–ü—Ä–∏–≤–µ—Ç, ${fullName}!\n\n–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ VPN –∏ –ø–æ–ª—É—á–∏—Ç–µ ${balance_no_referer}‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!\n\nüí∞ —Å–∞–º–∞—è –Ω–∏–∑–∫–∞—è —Ü–µ–Ω–∞ –Ω–∞ —Ä—ã–Ω–∫–µ!\nüöÄ –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å\nüíÉüèø –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Å–∞–π—Ç–∞–º\nüí≥ –æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∞–º–∏ –†–§ üá∑üá∫ –∏ –°–ë–ü\n\n–°—Ç–æ–∏–º–æ—Å—Ç—å ${pay_month}‚ÇΩ/–º–µ—Å –∑–∞ 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –¥–æ 5 —É—Å—Ç—Ä–æ–π—Å—Ç–≤.\n\nüë´ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –≤ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ ${balance_to_referer}‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞. –í–∞—à–∏ –¥—Ä—É–∑—å—è –ø–æ–ª—É—á–∞—Ç ${balance_have_referer}‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å!\n\n‚¨áÔ∏è ‚¨áÔ∏è  –ñ–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É!  ‚¨áÔ∏è ‚¨áÔ∏è`;\n\nconst json=$json;\n// const json=$node[\"Start\"].json;\njson.telegram.send_text=text;\n\nreturn [{\n  json\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -20,
        840
      ],
      "id": "72bfab57-7615-43d1-88bf-586b6082a387",
      "name": "ActivateNoRef"
    },
    {
      "parameters": {
        "jsCode": "const firstName = $json.telegram.from.first_name || '';\nconst lastName = $json.telegram.from.last_name || '';\nconst fullName = `${firstName} ${lastName}`.trim();\n\n\n//const balance_no_referer=$json.config.tarif.balance_no_referer;\nconst balance_have_referer=$json.config.tarif.balance_have_referer;\nconst balance_to_referer=$json.config.tarif.balance_to_referer;\n//const pay_month=$json.config.tarif.pay_month;\n\nconst bot_channel = $json.config.bot.bot_channel;\nconst bot_channel_markdown = bot_channel.replaceAll('_', '\\\\_');\n\nconst tarif=$json.user.tarif;\nconst balance=$json.user.balance;\n\n\nconst days=Math.floor(30*$json.user.balance/$json.user.tarif);\n\n\n\nconst text = `–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞, ${fullName}!\n\n–í–∞—à –±–∞–ª–∞–Ω—Å ${balance}‚ÇΩ (~${days} –¥–Ω–µ–π), –∞–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω\n–¢–∞—Ä–∏—Ñ ${tarif}‚ÇΩ/–º–µ—Å –∑–∞ 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∞–∫—Ç–∏–≤–Ω–æ 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.\n\n–ï—Å–ª–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Ö —Å–∫–∞—á–∞—Ç—å, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É \"–ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\".\n\nüë≠ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –≤ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ ${balance_to_referer}‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞. –í–∞—à–∏ –¥—Ä—É–∑—å—è –ø–æ–ª—É—á–∞—Ç ${balance_have_referer}‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å!\n\nüìå –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (!!) [–ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª](https://t.me/${bot_channel}) @${bot_channel_markdown}`;\n\n//\n\nconst json=$json;\n// const json=$node[\"Start\"].json;\njson.telegram.send_text=text;\n\nreturn [{\n  json\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -20,
        420
      ],
      "id": "4137cfd0-bb6d-41b0-ba75-0eea745fb75d",
      "name": "Welcome"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3dfc07b6-7d1f-4c30-857c-741439a5bf9b",
                    "leftValue": "={{$json.user.activated}}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Activated"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -520,
        -400
      ],
      "id": "fea2166a-e7a6-4c01-a52d-8cf6972ff75f",
      "name": "Switch2"
    },
    {
      "parameters": {
        "chatId": "={{$json.telegram.chat_id }}",
        "text": "={{$json.telegram.send_text}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üì±üíª –ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",
                    "additionalFields": {
                      "callback_data": "devices"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üë≠ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å",
                    "additionalFields": {
                      "callback_data": "invite"
                    }
                  },
                  {
                    "text": "üìñ –ü–æ–º–æ—â—å",
                    "additionalFields": {
                      "callback_data": "help"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "03293669-ffab-46c0-b9ae-3afe0ff73fac",
      "name": "Send Welcome",
      "type": "n8n-nodes-base.telegram",
      "position": [
        200,
        420
      ],
      "typeVersion": 1.2,
      "webhookId": "6e946434-be3a-4505-8523-1876c298dc58",
      "credentials": {
        "telegramApi": {
          "id": "9hfs9gxsjeru7ML3",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const text = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –∞–∫–∫–∞—É–Ω—Ç, 100‚ÇΩ —É –≤–∞—Å –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!\n\n–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏–º –≤–∞—à VPN!`;\n\n\n// const json=$json;\nconst json=$node[\"Start\"].json;\njson.telegram.send_text=text;\n\nreturn [{\n  json\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        160,
        -40
      ],
      "id": "5df50d3e-6da2-4183-8799-b0ae903da77b",
      "name": "Activated"
    },
    {
      "parameters": {
        "jsCode": "const json=$node[\"Start\"].json;\n\nreturn [{\n  json:{\n    first_start:true,\n    ...json\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        -40
      ],
      "id": "e4f4aa18-e90a-4dc5-ac62-0e3d46c5105c",
      "name": "Params"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE users SET\n  balance=balance+$2\nWHERE id=$1;",
        "options": {
          "queryReplacement": "={{$json.referrer.id}}, {{$json.config.tarif.balance_to_referer}}"
        }
      },
      "id": "183984c7-71fa-4860-af0b-72aef28dde71",
      "name": "SQL ReferrerAddBalance",
      "type": "n8n-nodes-base.mySql",
      "position": [
        -40,
        160
      ],
      "typeVersion": 2.4,
      "credentials": {
        "mySql": {
          "id": "x219LayYyFolDwme",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const text = `üéâ –í–∞—à –¥—Ä—É–≥ –ø—Ä–∏–Ω—è–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, –≤–∞–º –¥–æ–±–∞–≤–ª–µ–Ω–æ *50‚ÇΩ* –Ω–∞ –±–∞–ª–∞–Ω—Å!`;\n\n\n// const json=$json;\nconst json=$node[\"Start\"].json;\njson.telegram.send_text=text;\n\nreturn [{\n  json\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        160,
        160
      ],
      "id": "071c3177-b3b6-4b85-9275-53dde889947c",
      "name": "AcceptedRefferal"
    },
    {
      "parameters": {
        "chatId": "={{$json.referrer.id}}",
        "text": "={{$json.telegram.send_text}}",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "20c0ce6b-a883-4cb8-afc9-060b20b6795e",
      "name": "Send AcceptedReferral",
      "type": "n8n-nodes-base.telegram",
      "position": [
        360,
        160
      ],
      "typeVersion": 1.2,
      "webhookId": "6e946434-be3a-4505-8523-1876c298dc58",
      "credentials": {
        "telegramApi": {
          "id": "9hfs9gxsjeru7ML3",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.referrer.id}}",
                    "rightValue": 10000,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    },
                    "id": "e291151a-f1f4-465e-a70c-05a5c3dd2be0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "HaveReferrer"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        760,
        -40
      ],
      "id": "05d80587-2f4c-4456-b661-30b8dd3e1c8a",
      "name": "Switch3"
    },
    {
      "parameters": {
        "jsCode": "const json=$node[\"Start\"].json;\n\nreturn [{\n  json:{\n    first_start:true,\n    ...json\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        160
      ],
      "id": "433cd00f-151b-4a35-beb7-64e1ab994011",
      "name": "Params1"
    }
  ],
  "pinData": {
    "Start": [
      {
        "json": {
          "referrer": {
            "id": 6938197279,
            "username": "vpnclient_support",
            "first_name": "VPN Client",
            "last_name": "Support",
            "language_code": "en",
            "is_premium": 0,
            "referrer_id": null,
            "balance": "150.00",
            "tarif": "100.00",
            "activated": 1,
            "utm": "238560779",
            "created_at": "2025-04-23 10:27:49",
            "activated_at": "2025-04-23 10:35:10",
            "updated_at": "2025-04-23 10:39:29"
          },
          "user": {
            "id": 238560779,
            "username": "AntonDodonov",
            "first_name": "Anton Dodonov",
            "last_name": "",
            "language_code": "en",
            "is_premium": 1,
            "referrer_id": 6938197279,
            "balance": "100.00",
            "tarif": "100.00",
            "activated": 1,
            "utm": "6938197279",
            "created_at": "2025-04-23 10:39:25",
            "activated_at": "2025-04-23 10:39:30",
            "updated_at": "2025-04-23 10:50:29"
          },
          "args": {
            "referrer_id": 0,
            "utm": ""
          },
          "config": {
            "bot": {
              "bot_name": "VPN Client",
              "bot_username": "VPNclientBot",
              "bot_group": "VPNclient_chat",
              "bot_channel": "VPNclient_news",
              "bot_support": "VPNclient_support"
            },
            "tarif": {
              "balance_no_referer": 100,
              "balance_have_referer": 100,
              "balance_to_referer": 50,
              "pay_month": 100
            }
          },
          "telegram": {
            "update_id": 191616980,
            "message": {
              "message_id": 650,
              "from": {
                "id": 238560779,
                "is_bot": false,
                "first_name": "Anton Dodonov",
                "username": "AntonDodonov",
                "language_code": "en",
                "is_premium": true
              },
              "chat": {
                "id": 238560779,
                "first_name": "Anton Dodonov",
                "username": "AntonDodonov",
                "type": "private"
              },
              "date": 1745405428,
              "text": "/start",
              "entities": [
                {
                  "offset": 0,
                  "length": 6,
                  "type": "bot_command"
                }
              ]
            },
            "from": {
              "id": 238560779,
              "is_bot": false,
              "first_name": "Anton Dodonov",
              "username": "AntonDodonov",
              "language_code": "en",
              "is_premium": true
            },
            "user_id": 238560779,
            "chat_id": 238560779
          }
        }
      }
    ]
  },
  "connections": {
    "Log Referral (new user)": {
      "main": [
        []
      ]
    },
    "Send Friend Notification": {
      "main": [
        []
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UserActivate": {
      "main": [
        [
          {
            "node": "Activated",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Activated": {
      "main": [
        [
          {
            "node": "Params",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AlreadyActivated": {
      "main": [
        [
          {
            "node": "Send AlreadyActivated",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Welcome",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ActivateHaveRef",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ActivateNoRef",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Activate": {
      "main": [
        []
      ]
    },
    "ActivateHaveRef": {
      "main": [
        [
          {
            "node": "Send Activate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ActivateNoRef": {
      "main": [
        [
          {
            "node": "Send Activate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "AlreadyActivated",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "UserActivate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Welcome": {
      "main": [
        [
          {
            "node": "Send Welcome",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Activated": {
      "main": [
        [
          {
            "node": "Send Activated",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Params": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SQL ReferrerAddBalance": {
      "main": [
        [
          {
            "node": "AcceptedRefferal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AcceptedRefferal": {
      "main": [
        [
          {
            "node": "Send AcceptedReferral",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send AcceptedReferral": {
      "main": [
        [
          {
            "node": "Params1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "SQL ReferrerAddBalance",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute cmd_devices.json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Params1": {
      "main": [
        [
          {
            "node": "Execute cmd_devices.json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "81fce9a0-df36-4f80-8136-f5a163e10624",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "56b859031753f55d9255666ae2857967070b959d969d365ded7558e71170585b"
  },
  "id": "w3lUqmSM8mC6WKJd",
  "tags": [
    {
      "createdAt": "2025-04-15T13:59:44.589Z",
      "updatedAt": "2025-04-15T13:59:44.589Z",
      "id": "PAzHawzLXHrPScDu",
      "name": "Telegram"
    }
  ]
}